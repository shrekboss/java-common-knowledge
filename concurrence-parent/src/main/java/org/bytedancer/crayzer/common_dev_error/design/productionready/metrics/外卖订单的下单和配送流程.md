## 案例：外卖订单的下单和配送流程
OrderController 进行下单操作，下单操作前先判断参数，如果参数正确调用另一个服务查询商户状态，如果
商户在营业的话继续下单，下单成功后发一条消息到 RabbitMQ 进行异步配送流程；然后另一个 
DeliverOrderHandler 监听这条消息进行配送操作。(涉及同步调用和异步调用的业务流程)

分别为下单和配送这两个重要操作，建立一些指标进行监控。(对于配送操作，也是建立类似的 4 个指标。)
- **下单总数量指标**，监控整个系统当前累计的下单量；
- **下单请求指标**，对于每次收到下单请求，在处理之前 +1；
- **下单成功指标**，每次下单成功完成 +1；
- **下单失败指标**，下单操作处理出现异常 +1，并且把异常原因附加到指标上。

```
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-influx</artifactId>
</dependency>
```
使用 Micrometer 框架实现指标的收集，它也是 Spring Boot Actuator 选用的指标框架。它实现了各种指标
的抽象，常用的有三种：
- gauge（红色），它反映的是指标当前的值，是多少就是多少，不能累计，比如本例中的下单总数量指标，
又比如游戏的在线人数、JVM 当前线程数都可以认为是 gauge。
- counter（绿色），每次调用一次方法值增加 1，是可以累计的，比如本例中的下单请求指标。举一个例子，
如果 5 秒内调用了 10 次方法，Micrometer 也是每隔 5 秒把指标发送给后端存储系统一次，那么它可以只发
送一次值，其值为 10。
- timer（蓝色），类似 counter，只不过除了记录次数，还记录耗时，比如本例中的下单成功和下单失败两个
指标。

附加一些 tags 标签，作为补充数据。比如，当操作执行失败的时候，我们就会附加一个 reason 标签到指标上。

模拟数据说明：
当用户 ID<10 的时候，我们模拟用户数据无效的情况，当商户 ID 不为 2 的时候我们模拟商户不营业的情况。

第一种情况是，使用合法的用户 ID 和营业的商户 ID 运行一段时间：
`wrk -t 1 -c 1 -d 3600s http://localhost:45678/order/createOrder\?userId\=20\&merchantId\=2`

第二种情况是，模拟无效用户 ID 运行一段时间：
`wrk -t 1 -c 1 -d 3600s http://localhost:45678/order/createOrder\?userId\=2\&merchantId\=2`

第三种情况是，尝试一下因为商户不营业导致的下单失败：
`wrk -t 1 -c 1 -d 3600s http://localhost:45678/order/createOrder\?userId\=20\&merchantId\=1`

第四种情况是，配送停止。我们通过 curl 调用接口，来设置配送停止开关：
`第四种情况是，配送停止。我们通过 curl 调用接口，来设置配送停止开关：`