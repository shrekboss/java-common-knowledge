## 代码加锁：不要让“锁”事成为烦心事
### 加锁前要清楚锁和被保护的对象是不是一个层面的：lockscope
### 加锁要考虑锁的粒度和场景问题：lockgranularity
### 多把锁要小心死锁问题：deadlock
### 加锁和释放没有配对的问题
用一些代码质量工具或代码扫描工具（比如 Sonar）来帮助排查。这个问题在编码阶段就能发现。
### 分布式锁自动释放导致的重复逻辑执行的问题
1. 参考 Redisson 的 RedissonLock 的**锁续期机制**。锁续期是每次续一段时间，比如 30 秒，然后 10 秒
执行一次续期。虽然是无限次续期，但即使客户端崩溃了也没关系，不会无限期占用锁，因为崩溃后无法
自动续期(**Watch Dog 机制线程也就没有了**)自然最终会超时。
2. 看源码发现，**leaseTime** 必须是 -1 才会开启 Watch Dog 机制，也就是如果你想开启 Watch Dog 机
制必须使用默认的加锁时间为 30s。**如果你自己自定义时间，超过这个时间，锁就会自定释放，并不会延长**。

